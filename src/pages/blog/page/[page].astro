---
import BlogListing from '$modules/blog/components/listing.astro'
import Layout from '$app/components/layout.astro'
import SEO from '$core/components/seo.astro'

import { getBlogs } from '$modules/blog/functions/getBlogs'
import { previewKey } from '$core/constants/secrets/previewKey'

import type { BlogCollection } from '$modules/blog/models/Blog'

const { page } = Astro.params

let targetPage = Number(page)
let blogCollection: BlogCollection | undefined

try {
  blogCollection = await getBlogs(
    Number(targetPage),
    Astro.cookies.get('preview')?.value === previewKey
  )
} catch (error) {}

if (!blogCollection || blogCollection.items.length === 0) {
  return new Response(undefined, {
    status: 404,
  })
}
---

<Layout>
  <SEO
    slot="seo"
    title="Blog"
    description="Here's a list of all my blog posts."
    noindex
  />
  <BlogListing page={targetPage} collection={blogCollection} />
</Layout>
